<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Firza Radio Medan</title>

<style>
/* ---------------- GLOBAL ---------------- */
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',sans-serif}

body{
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  padding:15px;
  background:linear-gradient(120deg,#ff512f,#dd2476);
  transition:background 2s ease;
}

.radio-player{
  width:100%;
  max-width:420px;
  background:rgba(255,255,255,0.08);
  border-radius:20px;
  backdrop-filter:blur(15px);
  box-shadow:0 10px 30px rgba(0,0,0,0.4);
  overflow:hidden;
  color:#fff;
  padding-bottom:20px;
}

/* HEADER */
.header{text-align:center;padding:15px}
.header h1{font-size:22px;margin-bottom:3px}
.header p{opacity:.7;font-size:13px}

/* ------------ ALBUM ART + GLOW ---------------- */
.album-wrap{
  width:240px;
  height:240px;
  margin:20px auto 10px;
  position:relative;
}

#cover{
  width:100%;height:100%;
  border-radius:20px;
  background-size:cover;
  background-position:center;
  box-shadow:0 15px 35px rgba(0,0,0,0.5);
  /* Tambahkan transisi untuk efek yang lebih halus saat cover berubah */
  transition: background-image 0.5s ease; 
}

/* Tambahkan DIV baru untuk GLOW, karena fungsi extractColor Anda membutuhkan ini */
#cover-glow{
  position:absolute;
  top:0;left:0;
  width:100%;height:100%;
  filter:blur(15px);
  border-radius:20px;
  opacity:0;
  transition:opacity 1s ease;
}

/* ------------ TRACK INFO ------------- */
.track-info{text-align:center;padding:0 15px 15px}
#title{
  font-size:18px;font-weight:600;
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
}
#artist{opacity:.85;font-size:14px;margin-top:3px}

/* Controls */
.controls{padding:12px}

.playback-controls{
  display:flex;
  justify-content:center;
  gap:25px;
  margin-bottom:10px;
}

.control-btn{
  width:50px;height:50px;
  border-radius:50%;
  border:none;
  font-size:22px;
  background:rgba(255,255,255,0.15);
  color:white;
  cursor:pointer;
  transition:.3s;
}
.control-btn:hover{background:rgba(255,255,255,0.25)}
.play-btn{width:68px;height:68px;font-size:30px}

/* VOLUME */
.volume-controls{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:15px;
}

.volume-slider{
  width:65%;
  -webkit-appearance:none;
  height:6px;
  border-radius:5px;
  background:rgba(255,255,255,0.3);
}
.volume-slider::-webkit-slider-thumb{
  -webkit-appearance:none;
  width:18px;height:18px;
  border-radius:50%;
  background:white;
}

.footer{text-align:center;font-size:12px;opacity:.4;padding:10px}
</style>
</head>

<body>

<div class="radio-player" id="playerBox">

  <div class="header">
    <h1>Firza Radio Medan</h1>
    <p>More than the other</p>
  </div>

  <div class="album-wrap">
    <div id="cover-glow"></div> <div id="cover"></div>
  </div>

  <div class="track-info">
    <div id="title">Memuat...</div>
    <div id="artist">Menunggu data...</div>
  </div>

  <div class="controls">
    <div class="playback-controls">
      <button class="control-btn" id="prevBtn">‚èÆ</button>
      <button class="control-btn play-btn" id="playButton"><span id="playIcon">‚ñ∂</span></button>
      <button class="control-btn" id="nextBtn">‚è≠</button>
    </div>

    <div class="volume-controls">
      üîä <input type="range" id="volumeSlider" class="volume-slider" min="0" max="100" value="70">
    </div>
  </div>

  <div class="footer">¬© Firza Radio 2026</div>

</div>

<audio id="radio" src="https://stream.zeno.fm/49c2uvzd4reuv"></audio>

<script>
const id = "49c2uvzd4reuv";
const api = `https://zenoplay.zenomedia.com/api/zenofm/nowplaying/${id}`;
const defaultCover = "https://dpi4fupzvxbqq.cloudfront.net/rfm/uploads/blogo/300/300_1470024235.png";

const audio       = document.getElementById("radio");
const titleEl     = document.getElementById("title");
const artistEl    = document.getElementById("artist");
const coverEl     = document.getElementById("cover");
const coverGlow   = document.getElementById("cover-glow"); // Tambahan untuk glow
const playBtn     = document.getElementById("playButton");
const playIcon    = document.getElementById("playIcon");
const volumeSlider = document.getElementById("volumeSlider");
const playerBox    = document.getElementById("playerBox");

// --- DATABASE QARI/ARTIS ---
const qariDatabase = {
    'mishary': 'https://i.ytimg.com/vi/GLMp_EGGLfk/hq720.jpg?sqp=-oaymwExCK4FEIIDSFryq4qpAyMIARUAAIhCGAHwAQH4AdQGgALgA4oCDAgAEAEYciBWKDgwDw==&rs=AOn4CLAa_DZgLB8D4xcMTFPgxpnQghg_sw',
    'abdul': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT99qAcwhSDEUMmxHHzjEfna9YVgtg-04A8rDvXbaNtZf-70ZkRxFPl_i5J_he-DnfdtO7EhS0ouUaiu-hq_bE8Ni9U3xKBjsAdFgzAg4w&s=10',
    'adi hidayat': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQi7cw0cL0cs4aqyXA5sbBMBaCWGmW0D28pzruJKEWXlx9RYeQLuZouy9VlqLk9oWvOxlO7jHAh6QOXhjPyKPQZqz2rez4YV5XOPrgTTQ&s=10',
    'zainuddin': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSDo4WarU6dxMHRx3BFqisexu4euGqv9Ni9_JZA5jZBwA&s=10',
    'latif': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQSgeut2z_VzZzl5_B7sbcdxL2FkG3Rd3dOTaS3WCOXEA&s=10',
    'al sudais': 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/24/Abdulrahman_Al-Sudais.jpg/440px-Abdulrahman_Al-Sudais.jpg',
    'ghamdi': 'https://i.ibb.co/Wp0y1hG/ghamdi.jpg',
    'shatri': 'https://i.ibb.co/fQ5N204/shatri.jpg',
    'abdul basit': 'https://i.ibb.co/RzM805h/abdulbasit.jpg',
};
// ---------------------------------------------

/* FUNGSI BARU/MODIFIKASI: Mendapatkan Cover dari Database Qari */
function getQariCover(name) {
    const lowerName = name.toLowerCase().trim();
    for (const key in qariDatabase) {
        // Cek apakah nama artis mengandung keyword di database
        if (lowerName.includes(key)) {
            return qariDatabase[key];
        }
    }
    return null;
}

/* PLAY / PAUSE */
playBtn.onclick = () => {
  if (audio.paused) {
    audio.play();
    playIcon.textContent = "‚ùö‚ùö";
  } else {
    audio.pause();
    playIcon.textContent = "‚ñ∂";
  }
};

/* Volume */
volumeSlider.oninput = () => {
  audio.volume = volumeSlider.value / 100;
};

/* Color Extractor (untuk GLOW) */
function extractColor(url, callback){
  const img = new Image();
  img.crossOrigin = "anonymous";
  img.src = url;
  img.onload = () => {
    const c = document.createElement("canvas");
    const x = c.getContext("2d");
    c.width = img.width;
    c.height = img.height;
    x.drawImage(img,0,0);
    const d = x.getImageData(0,0,c.width,c.height).data;
    let r=0,g=0,b=0,count=0;
    for(let i=0;i<d.length;i+=4){
      r+=d[i]; g+=d[i+1]; b+=d[i+2]; count++;
    }
    callback(`rgb(${~~(r/count)},${~~(g/count)},${~~(b/count)})`);
  };
  // Handle error loading image
  img.onerror = () => callback("rgb(255,255,255)"); 
}

/* Fungsi untuk mengatur Glow pada cover */
function setGlow(color){
    coverGlow.style.background = `radial-gradient(circle, ${color}, transparent 70%)`;
    coverGlow.style.opacity = 1;
}

/* MODIFIKASI: iTunes Cover API (Sekarang menjadi Fallback) */
async function getCover(artist, title) {
  
  // 1. PRIORITAS: Cek Database Qari
  const qariCover = getQariCover(artist) || getQariCover(title);
  if (qariCover) {
      return qariCover;
  }
  
  // 2. FALLBACK: Cek iTunes
  try {
    const q = encodeURIComponent(`${artist} ${title}`);
    const res = await fetch(`https://itunes.apple.com/search?term=${q}&entity=song&limit=1`);
    const data = await res.json();
    if (data.results.length > 0) {
      return data.results[0].artworkUrl100.replace("100x100bb.jpg","600x600bb.jpg");
    }
  } catch {}
  
  // 3. TERAKHIR: Default Cover
  return defaultCover;
}

// ----- Background auto-change every 20‚Äì30 seconds -----
const bgSet = [
  ["#ff512f","#dd2476"],
  ["#1a2a6c","#b21f1f","#fdbb2d"],
  ["#00c6ff","#0072ff"],
  ["#7f00ff","#e100ff"],
  ["#ff9966","#ff5e62"]
];

function changeBG(){
  const bg = bgSet[Math.floor(Math.random()*bgSet.length)];
  document.body.style.background = `linear-gradient(120deg, ${bg.join(",")})`;
}

setInterval(changeBG, 25000);   // ~25 detik
changeBG();

/* Fetch Now Playing */
async function updateSong() {
  try {
    const res = await fetch(api);
    const data = await res.json();

    const text = data.title || "Live Stream";
    let artist = "";
    let title  = text;

    // Logika pemisahan Artist - Title
    if (text.includes(" - ")) {
      artist = text.split(" - ")[0].trim();
      title  = text.split(" - ")[1].trim();
    } else {
        // Coba identifikasi artist dari database Qari
        for (const key in qariDatabase) {
            if (text.toLowerCase().includes(key)) {
                artist = key.split(' ').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' '); 
                title = text.replace(new RegExp(key, 'gi'), '').trim();
                // Bersihkan title
                if (title.endsWith('-')) title = title.substring(0, title.length - 1).trim();
                if (title.startsWith('-')) title = title.substring(1).trim();
                if (title === "" || title.length < 3) title = "Murottal"; // Default Murottal jika judul kosong setelah dipisah
                break;
            }
        }
    }
    
    if (artist === "") artist = "Firza Radio Medan";


    titleEl.textContent = title;
    artistEl.textContent = artist;

    const cover = await getCover(artist, title);
    coverEl.style.backgroundImage = `url("${cover}")`;

    // Pastikan fungsi setGlow dipanggil dengan warna yang diekstrak
    extractColor(cover, (color)=> {
        setGlow(color);
        // Bonus: Ubah warna player box berdasarkan warna cover utama
        playerBox.style.boxShadow = `0 10px 30px ${color}80`; 
    });

  } catch(e) {
    titleEl.textContent = "Radio Stream";
    artistEl.textContent = "Gagal memuat data";
    coverEl.style.backgroundImage = `url("${defaultCover}")`;
    setGlow("rgb(255,255,255)"); // Atur glow ke putih jika gagal
  }
}

updateSong();
setInterval(updateSong, 20000);
</script>

</body>
</html>
